(function(){angular.module("idfBudgetApp",["ngResource","ngSanitize","ngRoute"]).config(["$routeProvider",function(a){return a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",reloadOnSearch:!1}).otherwise({redirectTo:"/"})}])}).call(this),function(){angular.module("idfBudgetApp").directive("landscape",function(){return{restrict:"A",scope:{foreground:"@",background:"@",wrapper:"@",listen:"@",scrollDuration:"@"},link:function(a,b,c){var d,e,f,g;return f=function(a){var c;return c=angular.isNumber(a)?".zone-"+a:a,b.scrollTo(c,{duration:d.scrollDuration,offset:-1*(e.width()/2-$(c).outerWidth()/2)})},e=b.parents(".main"),d={bg:angular.element(a.background||".background"),fg:angular.element(a.foreground||".foreground"),wp:angular.element(a.wrapper),bgVelocity:.3,fgVelocity:-.8,scrollDuration:a.scrollDuration||600},d.wp&&(g=$("<div />").css({width:d.wp.width(),height:d.wp.height(),overflow:"hidden",position:"relative"}),b.wrapInner(g)),b.on("scroll",function(){var a;return a=b.scrollLeft(),d.bg.css("left",a*d.bgVelocity),d.fg.css("left",a*d.fgVelocity)}),null!=a.listen?a.$parent.$watch(a.listen,f):void 0}}})}.call(this),function(){angular.module("idfBudgetApp").directive("bound",function(){return{restrict:"A",link:function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o;return h=b.parents(c.parent||window),n=h.outerWidth(),f=h.outerHeight(),k=c.step,g=1*(c.offset||0),l=c.bound.split(";"),2===l.length?(l={left:1*l[0],top:1*l[1]},j=d3.svg.line().x(function(a){return a.x}).y(function(a){return a.y}).interpolate("linear"),d=function(){return i.attr("d",j(e()))},e=function(){var a;return a=b.offset(),a={left:a.left-h.offset().left+g,top:a.top-h.offset().top+b.outerHeight()/2},k||(k=.5*(a.left-l.left)),a.left<l.left&&k>0&&(k*=-1),[{x:a.left,y:a.top},{x:a.left-k,y:a.top},{x:a.left-k,y:l.top},{x:l.left,y:l.top}]},o=$("<div />"),o.addClass("js-bound-draw").css({top:0,left:0,right:0,bottom:0,position:"absolute"}),h.append(o),m=d3.select(o[0]).append("svg").attr("width",n).attr("height",f),i=m.append("path").attr("stroke","#586063").attr("stroke-width",1).attr("fill","none"),b.hover(function(){return d(),o.removeClass("hidden")},function(){return o.addClass("hidden")})):void 0}}})}.call(this),function(){angular.module("idfBudgetApp").controller("MainCtrl",["$scope","$location","$http","$rootElement","$timeout",function(a,b,c,d,e){var f,g,h,i,j,k,l,m;return f=1,h=".home-center",g=d.find(".scrollable"),j=function(a){var b,c;return c=CSV.parse(a),c.length?(b=c.shift(),c=_.map(c,function(a){return _.object(b,a)})):void 0},k=function(a,b,c){return null==a&&(a=d),null==b&&(b="fade"),null==c&&(c=700),a.addClass(b),e(function(){return a.removeClass(b)},700)},m=function(){return a.detail!==a.getDetail(a.activeZone)?k(d.find(".js-fade"),"do-fade",700).then(function(){return a.detail=a.getDetail(a.activeZone)}):void 0},l=function(){var c;return c="home"===a.screen,a.screen=b.search().screen||"home","home"===a.screen&&a.zone(h),"detail"===a.screen&&c&&a.zone(f),"global"===a.screen?g.scrollTo({top:250,left:0},600):g.scrollTo(0,600)},i=function(){return _.findIndex(a.details,{id:a.activeZone})},a.to=function(a){return null==a&&(a="home"),b.search("screen",a)},a.zone=function(b){return null==b&&(b=!1),b&&(a.activeZone=b),a.activeZone},a.next=function(){return a.activeZone=a.details[i()+1].id},a.prev=function(){return a.activeZone=a.details[i()-1].id},a.hasNext=function(){return null!=a.details[i()+1]},a.hasPrev=function(){return null!=a.details[i()-1]},a.getDetail=function(b){return _.find(a.details,{id:b})},a.details=[],a.activeZone=h,a.screen="home",l(),c.get("./data/details.csv").success(function(b){return a.details=_.sortBy(j(b),function(a){return Number(a.id)}),_.each(a.details,function(a){return a.investissement_number=Number(String(a.investissement).replace(/,/,".")),a.fonctionnement_number=Number(String(a.fonctionnement).replace(/,/,"."))}),a.detail=a.getDetail(a.activeZone)}),c.get("./data/budget.csv").success(function(b){return a.budget=j(b)}),a.$watch("activeZone",m),a.$on("$routeUpdate",l)}])}.call(this),function(){angular.module("idfBudgetApp").directive("homothety",["$window",function(a){return{restrict:"A",link:function(b,c,d){var e,f,g,h;return g=function(){var a;return a=Math.min(1,h.width()/f),e.css("min-height",c.height()*a),c.css({transform:"scale("+a+")","transform-origin":"center top"}),a},f=c.outerWidth(),h=angular.element(a),e=angular.element("body"),h.on("resize",g),g()}}}])}.call(this);